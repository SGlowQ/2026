<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026高考倒计时×随机点名</title>
    <link rel="shortcut icon" href="favicon.ico">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <audio id="fiveStarSound" preload="auto">
        <source src="a.mp3" type="audio/mpeg">
        您的浏览器不支持音频播放。
    </audio>
    <style>
        /* 样式保持不变，与原始代码相同 */
        ::-webkit-scrollbar {
            display: none;
        }

        @font-face {
            font-family: 'Elements';
            src: url('genshin-icon.ttf') format('truetype');
        }

        :root {
            --pyro: #ff6752;
            /* 火 */
            --hydro: #4fc3f7;
            /* 水 */
            --anemo: #73e6c2;
            /* 风 */
            --electro: #b388ff;
            /* 雷 */
            --dendro: #a0d84f;
            /* 草 */
            --cryo: #99d9ea;
            /* 冰 */
            --geo: #ffcc29;
            /* 岩 */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: sans-serif;
            -webkit-user-select: none;
            /* Chrome, Safari, Opera */
            -moz-user-select: none;
            /* Firefox */
            -ms-user-select: none;
            /* Internet Explorer/Edge */
            user-select: none;
            /* Non-prefixed version, currently supported by Chrome, Opera and Firefox */
        }

        body {
            /* 设置背景图片 */
            background-image: url('https://t.alcy.cc/pc');
            /* 让背景图覆盖整个屏幕 */
            background-size: cover;
            /* 背景图居中 */
            background-position: center center;
            background-attachment: fixed;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* 添加半透明覆盖层 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(12, 20, 69, 0.7);
            /* 半透明深蓝色 */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }

        header {
            text-align: center;
            animation: fadeIn 5s ease-out;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            background:linear-gradient(220.55deg, #00E0EE 0%, #AD00FE 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #bbdefb;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .countdown-container {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 4rem 0;
            flex-wrap: wrap;
        }

        .countdown-box {
            background: rgba(25, 118, 210, 0.15);
            backdrop-filter: blur(5px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem 1.5rem;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .countdown-value {
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(to bottom, #e0f7fa, #80deea);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .countdown-label {
            font-size: 1.1rem;
            color: #e3f2fd;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #daysBox {
            height: 15rem;
            background: rgba(0, 0, 0, 0);
            backdrop-filter: none;
            border: none;
            box-shadow: none;
        }

        #daysBox .countdown-value {
            font-size: 10rem;
            opacity:0.5;
        }

        .motivation-container {
            background: rgba(21, 101, 192, 0.15);
            backdrop-filter: blur(5px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            margin: 4rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
        }

        .motivation-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 2rem;
        }

        .motivation-header h2 {
            font-size: 2.2rem;
            color: #bbdefb;
        }

        .motivation-header i {
            font-size: 2rem;
            color: #4fc3f7;
        }

        #hitokoto {
            background: linear-gradient(to bottom, #da75ff, #6a82fb);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.4rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            transition: opacity 0.5s ease;
        }

        .scrolling-names {
            display: flex;
            animation: scroll 180s linear infinite;
            white-space: nowrap;
            width: fit-content;
            will-change: transform;
        }

        .name-item {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 180px;
            height: 80px;
            background: rgba(41, 182, 246, 0.2);
            border-radius: 12px;
            margin: 0 10px;
            font-size: 1.4rem;
            font-weight: 500;
            padding: 0 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .name-item::after {
            content: "加油!";
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-size: 0.9rem;
            color: #00ff00;
            font-weight: 400;
        }

        .name-item:hover {
            transform: translateY(-5px);
            background: rgba(41, 182, 246, 0.3);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .name-item:hover::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(79, 172, 254, 0.3), rgba(0, 242, 254, 0.3));
            z-index: -1;
            border-radius: 12px;
        }

        .motivation-text {
            font-size: 1.8rem;
            text-align: center;
            margin: 3rem auto;
            width: auto;
            padding: 1.5rem;
            backdrop-filter: blur(5px);
            background: rgba(25, 118, 210, 0.2);
            border-radius: 16px;
        }

        footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            color: #90caf9;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        @keyframes scroll {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .countdown-box {
                min-width: 120px;
                padding: 1.5rem 1rem;
            }

            .countdown-value {
                font-size: 2.5rem;
            }

            .name-item {
                min-width: 150px;
                height: 70px;
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .countdown-box {
                min-width: 80px;
                padding: 1rem 0.5rem;
            }

            .countdown-value {
                font-size: 2rem;
            }

            .countdown-label {
                font-size: 0.9rem;
            }

            .name-item {
                min-width: 130px;
                height: 60px;
                font-size: 1.1rem;
            }
        }

        #lotteryBtn {
            transition: background 0.3s, box-shadow 0.3s;
            transition: all 0.3s ease;
        }

        #lotteryBtn:hover {
            background: #00aeff !important;
            box-shadow: 0 4px 15px rgba(41, 182, 246, 0.4);
        }

        #lotteryBtn:disabled {
            background: #b0bec5 !important;
            color: #eee !important;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.7;
        }

        /* 新增历史记录样式 */
        .history-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 3;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .history-btn:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.3);
        }

        .history-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 5;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .history-content {
            /*background: linear-gradient(135deg, #1a237e, #283593);*/
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            padding: 30px;
            border-radius: 20px;
            background: rgba(12, 20, 69);
            /* 半透明深蓝色 */
            position: relative;
        }

        .history-title {
            text-align: center;
            margin-bottom: 25px;
            color: #ffeb3b;
            font-size: 2rem;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .history-slider {
            overflow: hidden;
            position: relative;
        }

        .history-slides {
            display: flex;
            transition: transform 0.5s ease;
        }

        .history-group {
            min-width: 100%;
            padding: 0 10px;
            box-sizing: border-box;
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .group-title {
            font-size: 1.2rem;
            color: #bbdefb;
        }

        .group-date {
            font-size: 0.9rem;
            color: #90caf9;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }


        .item-name {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .item-rarity {
            font-weight: bold;
        }

        .five-star {
            color: #ffeb3b;
            text-shadow: 0 0 5px rgba(255, 235, 59, 0.5);
        }

        .four-star {
            color: #bb86fc;
            text-shadow: 0 0 5px rgba(187, 134, 252, 0.5);
        }

        .three-star {
            color: #03a9f4;
            text-shadow: 0 0 5px rgba(3, 169, 244, 0.5);
        }

        .item-time {
            font-size: 0.85rem;
            color: #90caf9;
        }

        .slider-controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 15px;
        }

        .slider-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .slider-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .slider-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .slider-dots {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 8px;
        }

        .slider-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider-dot.active {
            background: #4fc3f7;
            transform: scale(1.2);
        }

        .no-history {
            text-align: center;
            padding: 30px;
            color: #90caf9;
            font-style: italic;
        }

        /* 问卷与说明按钮样式 */
        .announcement-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .announcement-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* 问卷与说明弹窗样式 */
        .announcement-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 5;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .announcement-content {
            /*background: linear-gradient(135deg, #1a237e, #283593);*/
            width: 90%;
            max-width: 60rem;
            max-height: 80vh;
            overflow: hidden;
            padding: 30px;
            border-radius: 20px;
            background: rgba(12, 20, 69);
            position: relative;
        }

        .announcement-title {
            text-align: center;
            margin-bottom: 25px;
            color: #ffeb3b;
            font-size: 2rem;
        }

        .announcement-scroll {
            overflow-y: auto;
            max-height: 60vh;
            padding-right: 10px;
        }

        .announcement-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .announcement-item h3 {
            color: #4fc3f7;
            margin-bottom: 10px;
        }

        .announcement-item p {
            color: #e3f2fd;
            line-height: 1.5;
            margin-bottom: 5px;
        }

        /* 滚动条样式 */
        .announcement-scroll::-webkit-scrollbar {
            width: 5px;
        }

        .announcement-scroll::-webkit-scrollbar-thumb {
            background: #4fc3f7;
            border-radius: 10px;
        }

        /* 五星特效容器 - 初始状态全屏黑色 */
        .wish-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 6;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease-out;
        }

        /* 激活状态 */
        .wish-effect.active {
            opacity: 1;
            pointer-events: all;
        }


        /* 金光迸发效果 */
        .golden-light {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0) 0%, rgba(255, 215, 0, 0.8) 40%, rgba(255, 215, 0, 0.9) 70%);
            opacity: 0;
            transform: scale(0);
            filter: blur(5px);
        }

        /* 金光放大动画 */
        @keyframes goldenLightAnimation {
            0% {
                opacity: 0;
                transform: scale(5)translateZ(0);
            }

            40% {
                opacity: 1;
                transform: scale(10)translateZ(0);
            }

            70% {
                opacity: 1;
                transform: scale(5)translateZ(0);
            }

            100% {
                opacity: 0;
                transform: scale(50)translateZ(0);
            }
        }


        /* 角色名称展示 */
        .character-name {
            position: relative;
            text-align: center;
            opacity: 0;
            transform: translateY(50px) scale(3);
            /* 初始状态：放大3倍 */
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 7;
        }

        .character-name.revealed {
            opacity: 1;
            transform: translateY(0) scale(1);
            /* 最终状态：正常大小 */
        }

        .name-text {
            font-size: 10rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8),
                0 0 40px rgba(255, 215, 0, 0.6),
                0 0 60px rgba(255, 215, 0, 0.4);
            background: linear-gradient(45deg, #ffd700, #ffaa00, #ffd700, #ffaa00);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: textShine 4s ease infinite;
        }

        @keyframes textShine {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .stars {
            font-size: 4rem;
            color: #ffd700;
            letter-spacing: 5px;
            margin-top: 15px;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
        }

        /* 继续按钮 */
        .wish-continue-btn {
            position: absolute;
            bottom: 40px;
            right: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 1s ease, transform 0.3s ease, background 0.3s ease;
            z-index: 8;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .wish-continue-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .wish-effect.active .wish-continue-btn {
            opacity: 1;
        }

        #upInfo {
            display: flex;
            flex-direction: column;
            align-items: center;
            /* 水平居中 */
            gap: 0.6rem;
            /* 行间距 */
        }

        .up-line {
            display: flex;
            align-items: center;
            /* 图标与文字垂直居中 */
            justify-content: center;
            gap: 0.4rem;
            /* 图标与文字间距 */
        }
    </style>
</head>

<body>
    <!-- 五星抽中特效容器 -->
    <div id="wishEffect" class="wish-effect">
        <!-- 金光迸发效果 -->
        <div class="golden-light"></div>
        <!-- 角色名称展示 -->
        <div class="character-name">
            <span class="name-text"></span>
            <div class="stars">⭐⭐⭐⭐⭐</div>
        </div>
        <!-- 继续按钮 -->
        <button class="wish-continue-btn">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div style="position:absolute; right:32px; top:32px; z-index:10;">
        <a href="https://sglowq.github.io/2026/2026.png" target="_blank" title="点击查看二维码">
            <img src="2026.png" alt="二维码"
                style="width:150px; height:150px; border-radius:10px;cursor:pointer;opacity:0.2">
        </a>
    </div>
    <div class="container">
        <header>
            <h1>2026高考倒计时×随机点名</h1>
        </header>
        <div class="countdown-box" id="daysBox">
            <div class="countdown-value" id="days">365</div>
        </div>
        <div class="countdown-container">
            <div class="countdown-box">
                <div class="countdown-value" id="hours">24</div>
                <div class="countdown-label">小时</div>
            </div>
            <div class="countdown-box">
                <div class="countdown-value" id="minutes">60</div>
                <div class="countdown-label">分钟</div>
            </div>
            <div class="countdown-box">
                <div class="countdown-value" id="seconds">60</div>
                <div class="countdown-label">秒</div>
            </div>
            <div class="countdown-box">
                <div class="countdown-value" id="milliseconds">999</div>
                <div class="countdown-label">毫秒</div>
            </div>
        </div>

        <div class="motivation-text">
            <div id="hitokoto">加油哦</div>
            <div id="from">『一言』正在加载中~</div>
        </div>
        <div class="motivation-container">
            <div id="pityInfo" style="text-align:center; font-size:1rem; color:#bbdefb;">
                必中五星: <span id="fiveStarPityCount">0</span>/90 |
                必中四星: <span id="fourStarPityCount">0</span>/10
                <div>五星必中本期UP状态: <span id="fiveStarGuarantee" style="color:#ffeb3b;">未激活</span></div>
                <div>四星必中本期UP状态: <span id="fourStarGuarantee" style="color:#ffeb3b;">未激活</span></div>
                <div class="motivation-header">
                    <button class="announcement-btn" id="announcement-btn">
                        问卷与说明
                    </button>
                    <i class="fas fa-users"></i>
                    <h2>全体同学加油</h2>
                    <i class="fas fa-heart"></i>
                    <button id="lotteryBtn"
                        style="margin-left:20px;padding:8px 20px;font-size:1.1rem;border-radius:8px;background:#4fc3f7;color:#fff;border:none;cursor:pointer;">抽奖</button>
                    <!-- 历史记录按钮 -->
                    <button class="history-btn" id="history-btn"><i class="fas fa-history"></i></button>
                </div>
            </div>
            <div id="upInfo" style="text-align:center;margin-bottom:1.5rem;font-size:1.2rem;"></div>

            <div class="scrolling-names" id="scrollingNames">
                <!-- 名字将由JavaScript动态生成 -->
            </div>
            <div id="winner" style="text-align:center;font-size:3rem;color:#00ff00;margin-top:1.5rem;display:none;">
            </div>
        </div>

        <footer>
            <p>© 2025 星梦捕光 | 为2026届考生加油</p>
            <p>每一天的努力，都在拉近与梦想的距离</p>
        </footer>
    </div>

    <!-- 历史记录弹窗 -->
    <div class="history-container" id="history-container">
        <div class="history-content">
            <button class="close-btn" id="close-btn">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="history-title">当周抽卡历史记录</h2>
            <div class="history-slider">
                <div class="history-slides" id="history-slides">
                    <!-- 历史记录内容将通过JavaScript动态生成 -->
                </div>
            </div>
            <div class="slider-controls">
                <button class="slider-btn" id="prev-btn" disabled>
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="slider-btn" id="next-btn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="announcement-container" id="announcement-container">
        <div class="announcement-content">
            <button class="close-btn" id="announcement-close-btn">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="announcement-title">本网页说明</h2>
            <div class="announcement-scroll">
                <div class="announcement-item">
                    <h3><i class="fas fa-lightbulb"></i>问卷</h4>
                        <a
                            href="https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=DQSIkWdsW0yxEjajBLZtrQAAAAAAAAAAAAN__jMrgodUMlc5UDVMWUxFRElIVFBQNlNMQVVQTU02VS4u">
                            <button class="announcement-btn">点击进入问卷</button>
                        </a>
                </div>
                <div class="announcement-item">
                    <h3><i class="fas fa-clock"></i> 倒计时功能说明</h3>
                    <p>本页面顶部显示的高考倒计时是针对2026年高考的设备实时倒计时，精确到毫秒级。</p>
                    <ul>
                        <li>倒计时目标日期：2026年06月07日00:00:00.000</li>
                        <li>显示格式：天、时、分、秒、毫秒</li>
                        <li>数据更新：每毫秒自动刷新</li>
                    </ul>
                </div>

                <div class="announcement-item">
                    <h3><i class="fas fa-quote-left"></i> 一言功能说明</h3>
                    <p>页面中的励志语句来自「一言」API，每10秒自动更新一次。</p>
                    <ul>
                        <li>数据来源：hitokoto.cn 提供的开放API</li>
                        <li>更新频率：20秒/次</li>
                        <li>内容类型：包含古今中外的名言警句、经典台词和文学语句</li>
                    </ul>
                </div>

                <div class="announcement-item">
                    <h3><i class="fas fa-dice"></i> 抽奖机制详细说明</h3>
                    <p>本抽奖系统模拟了『原神』抽卡机制，包含保底机制和UP角色设定。</p>
                    <h4>概率分布</h4>
                    <ul>
                        <li><span class="five-star">五星</span>概率：0.6% (每90抽必出五星)</li>
                        <li><span class="four-star">四星</span>概率：5.1% (每10抽必出四星)</li>
                        <li><span class="three-star">三星</span>概率：94.3%</li>
                    </ul>

                    <h4>保底机制</h4>
                    <ul>
                        <li><strong><span class="five-star">五星</span>保底</strong>：连续89抽未出<span
                                class="five-star">五星</span>时，第90抽必出<span class="five-star">五星</span></li>
                        <li><strong><span class="four-star">四星</span>保底</strong>：连续9抽未出<span
                                class="four-star">四星</span>时，第10抽必出<span class="four-star">四星</span></li>
                        <li><strong><span class="five-star">五星UP</span>机制（状态不清空）</strong>：当获得<span
                                class="five-star">五星</span>时，有50%概率为当期UP角色；若未获得UP角色，则下一次<span
                                class="five-star">五星</span>必定为UP角色</li>
                        <li><strong><span class="four-star">四星UP</span>机制（状态不清空）</strong>：当获得<span
                                class="four-star">四星</span>时，有50%概率为当期UP角色之一；若未获得UP角色，则下一次<span
                                class="four-star">四星</span>必定为UP角色</li>
                    </ul>

                    <h4>UP角色规则</h4>
                    <ul>
                        <li>每次页面刷新会随机选择1名<span class="five-star">五星UP</span>角色和3名<span class="four-star">四星UP</span>角色
                        </li>
                        <li>UP角色从班级同学名单中随机抽取。</li>
                        <li>UP状态仅在当前页面有效，刷新页面后会重新随机分配。</li>
                    </ul>

                    <h4>其他规则</h4>
                    <ul>
                        <li>抽奖次数和小保底计数每周重置（基于浏览器本地存储）</li>
                        <li>大保底状态（必出UP）会持续到抽中UP角色为止</li>
                        <li>每次抽奖会记录在抽卡历史记录中，可按日期查看</li>
                        <li>注意：除了本期的<span class="four-star">四星UP</span>和<span
                                class="five-star">五星UP</span>固定，其余的人都有可能重复成为普通的<span class="five-star">五星</span>、<span
                                class="four-star">四星</span>以及<span class="three-star">三星</span></li>

                    </ul>
                </div>

                <div class="announcement-item">
                    <h3><i class="fas fa-scroll"></i> 名字滚动效果说明</h3>
                    <ul>
                        <li>名字列表：包含班级目前所有同学名字</li>
                        <li>滚动方式：无限循环横向滚动</li>
                        <li>名字顺序：每次次刷新后重新随机排列</li>
                        <li>交互效果：悬停时名字会有上浮效果和特殊光效</li>
                    </ul>
                </div>

                <div class="announcement-item">
                    <h3><i class="fas fa-history"></i> 历史记录功能</h3>
                    <p>抽奖历史记录功能允许查看当周的所有抽奖结果。</p>
                    <ul>
                        <li>查看方式：点击右侧历史记录按钮（回溯时钟图标）</li>
                        <li>记录内容：包含抽中角色、稀有度和抽奖时间</li>
                        <li>分组显示：每5条记录为一组，支持跳转</li>
                        <li>数据存储：使用浏览器本地存储，仅保存当周记录。</li>

                        <li>稀有度标识：<span class="five-star">五星</span>、<span class="four-star">四星</span>、<span
                                class="three-star">三星</span></li>
                        <li>注意：因为每次刷新页面后，名字的up和星级都会改变，可能有一个人的名字有不同的等级</li>
                    </ul>
                </div>

                <script>
                    //禁止右键
                    document.addEventListener('contextmenu', function (event) {
                        event.preventDefault();
                    });
                    // 设置高考日期（2026年6月7日）
                    const examDate = new Date('June 7, 2026 00:00:00').getTime();



                    // 更新倒计时
                    function updateCountdown() {
                        const now = new Date().getTime();
                        const distance = examDate - now;

                        // 计算天、时、分、秒、毫秒
                        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                        const hours = Math.floor(distance / (1000 * 60 * 60));
                        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                        const milliseconds = Math.floor(distance % 1000);

                        // 更新显示
                        document.getElementById('days').innerText = days + "天";
                        document.getElementById('hours').innerText = hours.toString().padStart(2, '0');
                        document.getElementById('minutes').innerText = minutes.toString().padStart(2, '0');
                        document.getElementById('seconds').innerText = seconds.toString().padStart(2, '0');
                        document.getElementById('milliseconds').innerText = milliseconds.toString().padStart(3, '0');

                        requestAnimationFrame(updateCountdown);
                    }

                    document.addEventListener('DOMContentLoaded', function () {
                        // 初始化一言
                        let hitokotoInterval;
                        let isUpdating = false;
                        function updateHitokoto() {
                            if (isUpdating) return;
                            isUpdating = true;
                            fetch('https://v1.hitokoto.cn')
                                .then(response => response.json())
                                .then(data => {
                                    const hitokoto = data.hitokoto || '';
                                    const from = data.from ? `『${data.from}』` : '';
                                    const fromWho = data.from_who ? `${data.from_who}` : '';

                                    // 淡出效果 - 仅针对文本元素
                                    const hitokotoElement = document.getElementById('hitokoto');
                                    const fromElement = document.getElementById('from');

                                    // 使用更平滑的CSS transition实现淡出
                                    hitokotoElement.style.transition = 'opacity 0.5s ease';
                                    fromElement.style.transition = 'opacity 0.5s ease';
                                    hitokotoElement.style.opacity = 0;
                                    fromElement.style.opacity = 0;

                                    // 等待淡出完成后再更新内容
                                    setTimeout(() => {
                                        // 更新文本内容
                                        hitokotoElement.innerText = hitokoto;
                                        fromElement.innerText = from + fromWho;
                                        fromElement.style.fontSize = '20px';

                                        // 淡入效果
                                        hitokotoElement.style.opacity = 1;
                                        fromElement.style.opacity = 1;

                                        // 动画完成后重置transition属性
                                        setTimeout(() => {
                                            hitokotoElement.style.transition = '';
                                            fromElement.style.transition = '';
                                            isUpdating = false;
                                        }, 500);
                                    }, 500);
                                })
                                .catch(console.error);
                        }

                        // 立即执行一次
                        updateHitokoto();
                        // 每20秒刷新一次
                        hitokotoInterval = setInterval(updateHitokoto, 20000);
                        // 页面卸载时清除定时器
                        window.addEventListener('unload', () => {
                            clearInterval(intervalId);
                        });
                        document.addEventListener('visibilitychange', function () {
                            if (document.hidden) {
                                // 页面隐藏时停止一言刷新
                                clearInterval(hitokotoInterval);
                            } else {
                                // 页面显示时恢复一言刷新
                                hitokotoInterval = setInterval(updateHitokoto, 20000);
                            }
                        });
                    });


                    // 获取元素
                    const announcementBtn = document.getElementById('announcement-btn');
                    const announcementContainer = document.getElementById('announcement-container');
                    const announcementCloseBtn = document.getElementById('announcement-close-btn');

                    // 显示问卷与说明
                    announcementBtn.addEventListener('click', function () {
                        announcementContainer.style.display = 'flex';
                    });

                    // 关闭问卷与说明
                    announcementCloseBtn.addEventListener('click', function () {
                        announcementContainer.style.display = 'none';
                    });

                    // 点击空白处关闭
                    announcementContainer.addEventListener('click', function (e) {
                        if (e.target === this) {
                            this.style.display = 'none';
                        }
                    });

                    // Fisher-Yates 洗牌算法
                    function shuffleArray(array) {
                        const newArray = [...array]; // 创建副本避免修改原数组
                        for (let i = newArray.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [newArray[i], newArray[j]] = [newArray[j], newArray[i]]; // 交换元素
                        }
                        return newArray;
                    }

                    // 元素图标表
                    const elementMap = [
                        { char: '\ue001', color: 'var(--pyro)' }, // 火
                        { char: '\ue002', color: 'var(--hydro)' }, // 水
                        { char: '\ue003', color: 'var(--anemo)' }, // 风
                        { char: '\ue004', color: 'var(--electro)' }, // 雷
                        { char: '\ue005', color: 'var(--dendro)' }, // 草
                        { char: '\ue006', color: 'var(--cryo)' }, // 冰
                        { char: '\ue007', color: 'var(--geo)' }  // 岩
                    ];

                    // 2. 生成带随机元素图标的名字数组（洗牌前完成）
                    const students = [
                        "张永沛", "雷俊杰", "陈馨怡", "殷俊强", "郑奎", "李依婷", "王俊楠",
                        "贺梦菲", "黄金婷", "兰雨檐", "肖涵", "陈慧丽", "崔雯", "马英宸",
                        "阮方钰", "袁卓峰", "徐啟锐", "刘一凡", "李健", "韦南楠",
                        "阮心怡", "杨玉艺", "贺鹏城", "刘艺栋", "陈晨", "樊灵",
                        "毛振宇", "徐馨", "索俊俊", "陈鑫", "徐一帆", "刘晨阳",
                        "吴金昊", "阮玮", "代艳兴", "熊娜", "查钰钒",
                        "程琳琳", "柯贤威", "茹官旺", "毛静雯", "朱治锦", "杨起浩",
                        "樵世诚", "熊娅妮", "黄海棠", "程修均", "张维哲", "徐可欣",
                        "张钰箐", "夏增婷", "吴昊昊", "周笠", "任鹏飞", "谢昌农",
                        "程凯", "朱海英", "黄佳辉", "曹旖诺", "谢易航", "巩玉蓉"
                    ].map((name) => {
                        const randomIndex = Math.floor(Math.random() * elementMap.length);
                        const el = elementMap[randomIndex];
                        return `<i style="font-family:Elements;font-size:1.4rem;color:${el.color};margin-right:6px;font-style:normal;">${el.char}</i>${name}`;
                    });

                    // 随机选UP角色
                    function pickUPs(arr, count) {
                        const copy = [...arr];
                        const result = [];
                        for (let i = 0; i < count; i++) {
                            const idx = Math.floor(Math.random() * copy.length);
                            result.push(copy[idx]);
                            copy.splice(idx, 1);
                        }
                        return result;
                    }

                    // 页面刷新时随机UP（不保存到localStorage）
                    let fiveStarUP = pickUPs(students, 1)[0];
                    let fourStarUPs = pickUPs(students.filter(s => s !== fiveStarUP), 3);

                    // 展示UP信息
                    function updateUPDisplay() {
                        const fiveIcon = fiveStarUP.match(/<i[^>]*>.*?<\/i>/)[0];
                        const fiveText = fiveStarUP.replace(/<i[^>]*>.*?<\/i>/, '');

                        const fourHtml = fourStarUPs.map(n => {
                            const icon = n.match(/<i[^>]*>.*?<\/i>/)[0];
                            const txt = n.replace(/<i[^>]*>.*?<\/i>/, '');
                            return `${icon}<span style="background:linear-gradient(90deg,#A259FF,#8F5AFF);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold;">${txt}</span>`;
                        }).join('&nbsp;&nbsp;&nbsp;&nbsp;');   // 2. 四星三人之间增加 4 个空格

                        document.getElementById('upInfo').innerHTML = `
                            <div class="up-line">
                                <span style="font-weight:bold;color:#FFD700;">五星UP：</span>
                                ${fiveIcon}
                                <span style="background:linear-gradient(90deg,#FFD700,#FFA500);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold;">${fiveText}</span>
                            </div>
                            <div class="up-line">
                                <span style="font-weight:bold;color:#A259FF;">四星UP：</span>
                                ${fourHtml}
                            </div>
                        `;
                    }

                    updateUPDisplay();

                    const shuffledStudents = shuffleArray(students);
                    console.log("打乱后的名单:", shuffledStudents);

                    function generateScrollingNames() {
                        const container = document.getElementById('scrollingNames');
                        container.innerHTML = '';
                        // 生成两倍名单
                        const doubleList = [...shuffledStudents, ...shuffledStudents];
                        doubleList.forEach(student => {
                            const nameElement = document.createElement('div');
                            nameElement.className = 'name-item';
                            nameElement.innerHTML = student;
                            container.appendChild(nameElement);
                        });
                    }

                    // 稀有度配置
                    const rarityConfig = [
                        { name: '⭐⭐⭐⭐⭐', color: 'linear-gradient(90deg,#FFD700,#FFA500)', textColor: '#000', chance: 0.006 },
                        { name: '⭐⭐⭐⭐', color: 'linear-gradient(90deg,#A259FF,#8F5AFF)', textColor: '#fff', chance: 0.051 },
                        { name: '⭐⭐⭐', color: 'linear-gradient(90deg,#00bfff,#1e90ff)', textColor: '#fff', chance: 0.943 }
                    ];

                    // 初始更新
                    updateCountdown();
                    generateScrollingNames();


                    // 抽奖效果
                    const lotteryBtn = document.getElementById('lotteryBtn');
                    const scrollingNames = document.getElementById('scrollingNames');
                    const winnerDiv = document.getElementById('winner');
                    let isRolling = false;

                    // 获取当天key（只用于抽奖次数）
                    function getTodayKey(key) {
                        const today = new Date();
                        return key + '_' + today.getFullYear() + '_' + today.getMonth() + '_' + today.getDate();
                    }

                    // 获取当前是第几周
                    function getWeekNumber(date = new Date()) {
                        const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
                        const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
                        // 周一为一周开始
                        return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay()) / 7);
                    }

                    // 获取本周key（用于抽奖次数和保底）
                    function getWeekKey(key) {
                        const today = new Date();
                        const week = getWeekNumber(today);
                        return key + '_' + today.getFullYear() + '_W' + week;
                    }

                    // 获取本周历史记录key
                    function getHistoryKey() {
                        const today = new Date();
                        const week = getWeekNumber(today);
                        return 'gachaHistory_' + today.getFullYear() + '_W' + week;
                    }

                    // 获取保底次数
                    function getPity(key, defaultValue = 0) {
                        const weekKey = getWeekKey(key);
                        const value = localStorage.getItem(weekKey);
                        return value ? parseInt(value) : defaultValue;
                    }

                    // 设置保底次数
                    function setPity(key, value) {
                        const weekKey = getWeekKey(key);
                        localStorage.setItem(weekKey, value);
                    }

                    // 初始化保底（只保存抽奖次数，不保存UP）
                    let totalDraws = getPity('totalDraws', 0);
                    let fiveStarPity = getPity('fiveStarPity', 0);
                    let fourStarPity = getPity('fourStarPity', 0);

                    // 添加大保底状态变量
                    let isGuaranteed5StarUP = localStorage.getItem('isGuaranteed5StarUP') === 'true';
                    let isGuaranteed4StarUP = localStorage.getItem('isGuaranteed4StarUP') === 'true';

                    // 更新保底信息显示
                    function updatePityDisplay() {
                        document.getElementById('fiveStarPityCount').innerHTML = fiveStarPity;
                        document.getElementById('fourStarPityCount').innerHTML = fourStarPity;
                        document.getElementById('fiveStarGuarantee').innerHTML = isGuaranteed5StarUP ? "已激活" : "未激活";
                        document.getElementById('fourStarGuarantee').innerHTML = isGuaranteed4StarUP ? "已激活" : "未激活";

                        // 根据状态改变颜色
                        document.getElementById('fiveStarGuarantee').style.color = isGuaranteed5StarUP ? "#00ff00" : "#ffeb3b";
                        document.getElementById('fourStarGuarantee').style.color = isGuaranteed4StarUP ? "#00ff00" : "#ffeb3b";
                    }

                    // 在页面加载时初始化显示
                    updatePityDisplay();


                    // 抽奖按钮文本显示抽奖次数
                    function updateLotteryBtnText() {
                        lotteryBtn.innerText = `抽奖（已抽${totalDraws}次）`;
                    }
                    updateLotteryBtnText();

                    // 历史记录相关功能
                    let currentSlide = 0;
                    let totalSlides = 0;

                    // 获取当天历史记录key
                    function getHistoryKey() {
                        const today = new Date();
                        const week = getWeekNumber(today);
                        return 'gachaHistory_' + today.getFullYear() + '_W' + week;
                    }

                    // 添加历史记录
                    function addHistoryRecord(name, rarity, isUP) {
                        const historyKey = getHistoryKey();
                        const history = JSON.parse(localStorage.getItem(historyKey) || '[]');

                        const now = new Date();
                        const dateStr = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
                        const timeStr = now.toLocaleTimeString();

                        const newRecord = {
                            name: name,
                            rarity: rarity,
                            isUP: isUP,
                            date: dateStr, 
                            time: timeStr
                        };

                        history.unshift(newRecord);
                        localStorage.setItem(historyKey, JSON.stringify(history));
                    }

                    // 显示历史记录
                    function showHistory() {
                        const historyKey = getHistoryKey();
                        const history = JSON.parse(localStorage.getItem(historyKey) || '[]');
                        const slidesContainer = document.getElementById('history-slides');

                        slidesContainer.innerHTML = '';

                        if (history.length === 0) {
                            slidesContainer.innerHTML = '<div class="no-history">本周暂无抽卡记录</div>';
                            document.getElementById('prev-btn').disabled = true;
                            document.getElementById('next-btn').disabled = true;
                            document.getElementById('history-container').style.display = 'flex';
                            return;
                        }

                        // 计算总页数（每5条一组）
                        totalSlides = Math.ceil(history.length / 5);
                        currentSlide = 0;

                        // 更新按钮状态
                        document.getElementById('prev-btn').disabled = true;
                        document.getElementById('next-btn').disabled = totalSlides <= 1;

                        // 创建历史记录内容
                        for (let i = 0; i < totalSlides; i++) {
                            const group = document.createElement('div');
                            group.className = 'history-group';

                            // 页码信息
                            const groupHeader = document.createElement('div');
                            groupHeader.className = 'group-header';

                            const groupTitle = document.createElement('div');
                            groupTitle.className = 'group-title';
                            groupTitle.innerHTML = `第 ${i + 1} 页 / 共 ${totalSlides} 页`;

                            groupHeader.appendChild(groupTitle);
                            group.appendChild(groupHeader);

                            // 添加组内记录
                            for (let j = i * 5; j < Math.min((i + 1) * 5, history.length); j++) {
                                const record = history[j];
                                const item = document.createElement('div');
                                item.className = 'history-item';

                                const nameSpan = document.createElement('span');
                                nameSpan.className = 'item-name';
                                nameSpan.innerHTML = record.name;

                                const raritySpan = document.createElement('span');
                                raritySpan.className = 'item-rarity';

                                if (record.rarity === 0) {
                                    raritySpan.classList.add('five-star');
                                    raritySpan.innerHTML = '五星' + (record.isUP ? ' UP!' : '');
                                    nameSpan.style.color = '#FFD700';  // 金色
                                } else if (record.rarity === 1) {
                                    raritySpan.classList.add('four-star');
                                    raritySpan.innerHTML = '四星' + (record.isUP ? ' UP!' : '');
                                    nameSpan.style.color = '#A259FF';  // 紫色
                                } else {
                                    raritySpan.classList.add('three-star');
                                    raritySpan.innerHTML = '三星';
                                    nameSpan.style.color = '#03a9f4';  // 蓝色
                                }

                                const timeSpan = document.createElement('span');
                                timeSpan.className = 'item-time';
                                timeSpan.innerHTML = (record.date ? record.date : '') + ' ' + record.time;

                                item.appendChild(nameSpan);
                                item.appendChild(raritySpan);
                                item.appendChild(timeSpan);

                                group.appendChild(item);
                            }

                            slidesContainer.appendChild(group);
                        }

                        // 生成输入框和跳转按钮的HTML
                        const pageJumpHTML = `
                                <input type="number" id="page-input" min="1" max="${totalSlides}" value="1"
                                    style="width:auto;height:36px;border:1px solid #90caf9;border-radius:8px;padding:0 8px;
                                    font-size:1rem;background:rgba(255,255,255,0.08);color:#fff;outline:none;transition:border 0.2s;">
                                <button id="jump-btn" class="slider-btn" style="margin:0 10px;height:36px;width:60px;border-radius:8px;font-size:1rem;background:#4fc3f7;color:#fff;">跳转</button>
                            `;

                        // 获取slider-controls容器
                        const controls = document.querySelector('.slider-controls');
                        // 清空原内容
                        controls.innerHTML = `
                                <button class="slider-btn" id="prev-btn">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                ${pageJumpHTML}
                                <button class="slider-btn" id="next-btn">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            `;

                        // 绑定事件
                        document.getElementById('prev-btn').onclick = function () {
                            goToSlide(currentSlide - 1);
                        };
                        document.getElementById('next-btn').onclick = function () {
                            goToSlide(currentSlide + 1);
                        };
                        document.getElementById('jump-btn').onclick = function () {
                            const val = parseInt(document.getElementById('page-input').value, 10);
                            if (val >= 1 && val <= totalSlides) {
                                goToSlide(val - 1);
                            }
                        };
                        document.getElementById('page-input').onkeydown = function (e) {
                            if (e.key === 'Enter') {
                                document.getElementById('jump-btn').click();
                            }
                        };

                        // 重置到第一页
                        goToSlide(0);

                        // 显示弹窗
                        document.getElementById('history-container').style.display = 'flex';
                    }

                    // 修改goToSlide函数，切换页时同步输入框和页码显示
                    function goToSlide(index) {
                        if (index < 0 || index >= totalSlides) return;

                        currentSlide = index;
                        const slidesContainer = document.getElementById('history-slides');
                        slidesContainer.style.transform = `translateX(-${currentSlide * 100}%)`;

                        // 更新按钮状态
                        document.getElementById('prev-btn').disabled = currentSlide === 0;
                        document.getElementById('next-btn').disabled = currentSlide === totalSlides - 1;

                        // 同步输入框
                        const input = document.getElementById('page-input');
                        if (input) input.value = currentSlide + 1;

                        // 同步页码显示
                        const allHeaders = document.querySelectorAll('.group-header .group-title');
                        allHeaders.forEach((el, idx) => {
                            el.innerHTML = `第 ${idx + 1} 页 / 共 ${totalSlides} 页`;
                        });
                    }

                    // 初始化历史记录功能
                    document.getElementById('history-btn').addEventListener('click', showHistory);
                    document.getElementById('close-btn').addEventListener('click', function () {
                        document.getElementById('history-container').style.display = 'none';
                        // 关闭时重置到第一页
                        goToSlide(0);
                    });

                    document.getElementById('prev-btn').addEventListener('click', function () {
                        goToSlide(currentSlide - 1);
                    });

                    document.getElementById('next-btn').addEventListener('click', function () {
                        goToSlide(currentSlide + 1);
                    });

                    // 点击空白处关闭弹窗
                    document.getElementById('history-container').addEventListener('click', function (e) {
                        if (e.target === this) {
                            this.style.display = 'none';
                            // 关闭时重置到第一页
                            goToSlide(0);
                        }
                    });

                    lotteryBtn.addEventListener('click', function () {
                        if (isRolling) return;
                        isRolling = true;
                        winnerDiv.style.display = 'none';
                        lotteryBtn.disabled = true;

                        const winnerIndex = Math.floor(Math.random() * scrollingNames.childNodes.length);

                        // 固定滚动总时长为5秒
                        const totalTime = 61; // 毫秒
                        const totalSteps = 61; // 总步数
                        const interval = totalTime / totalSteps;

                        let currentIndex = 0;
                        let step = 0;
                        let lastTime = null;

                        function highlightRolling(index) {
                            scrollingNames.childNodes.forEach((el, i) => {
                                if (i === index) {
                                    el.style.background = 'linear-gradient(90deg,#00eaff,#00ff99)';
                                    el.style.color = '#222';
                                    el.style.fontWeight = 'bold';
                                    el.style.boxShadow = '0 0 16px 6px #00eaff';
                                    el.style.border = '2px solid #00ff99';
                                } else {
                                    el.style.background = '';
                                    el.style.color = '';
                                    el.style.fontWeight = '';
                                    el.style.boxShadow = '';
                                    el.style.border = '';
                                }
                            });
                        }

                        function roll(now) {
                            if (!lastTime) lastTime = now;
                            if (step < totalSteps) {
                                if (now - lastTime >= interval) {
                                    highlightRolling(currentIndex);
                                    currentIndex = (currentIndex + 1) % scrollingNames.childNodes.length;
                                    step++;
                                    lastTime = now;
                                }
                                requestAnimationFrame(roll);
                            } else {
                                // 保底机制
                                let rarityIndex = 2; // 默认三星
                                totalDraws++;
                                fiveStarPity++;
                                fourStarPity++;

                                if (fiveStarPity >= 90) {
                                    rarityIndex = 0; // 五星保底
                                    fiveStarPity = 0;
                                    fourStarPity = 0;
                                } else if (fourStarPity >= 10) {
                                    rarityIndex = 1; // 四星保底
                                    fourStarPity = 0;
                                } else {
                                    const rand = Math.random();
                                    if (rand < rarityConfig[0].chance) {
                                        rarityIndex = 0;
                                        fiveStarPity = 0;
                                        fourStarPity = 0;
                                    } else if (rand < rarityConfig[0].chance + rarityConfig[1].chance) {
                                        rarityIndex = 1;
                                        fourStarPity = 0;
                                    }
                                }

                                // 保存抽奖次数（不保存UP）
                                setPity('totalDraws', totalDraws);
                                setPity('fiveStarPity', fiveStarPity);
                                setPity('fourStarPity', fourStarPity);

                                updateLotteryBtnText();

                                // 先决定中奖人（使用当前UP，而不是保存的UP）
                                let winnerName = '';
                                let isUP = false;
                                if (rarityIndex === 0) { // 五星
                                    // 先重置保底计数器
                                    fiveStarPity = 0;
                                    fourStarPity = 0;

                                    if (isGuaranteed5StarUP) {
                                        // 大保底状态，必出UP角色
                                        winnerName = fiveStarUP;
                                        isUP = true;
                                        isGuaranteed5StarUP = false; // 使用大保底后重置
                                    } else {
                                        // 小保底，50%概率UP
                                        if (Math.random() < 0.5) {
                                            winnerName = fiveStarUP;
                                            isUP = true;
                                        } else {
                                            const candidates = students.filter(s => s !== fiveStarUP);
                                            winnerName = candidates[Math.floor(Math.random() * candidates.length)];
                                            isUP = false;
                                            isGuaranteed5StarUP = true; // 触发大保底状态
                                        }
                                    }

                                    // 保存大保底状态
                                    localStorage.setItem('isGuaranteed5StarUP', isGuaranteed5StarUP);
                                    showFiveStarEffect(winnerName);
                                } else if (rarityIndex === 1) { // 四星
                                    // 重置四星保底计数器
                                    fourStarPity = 0;

                                    if (isGuaranteed4StarUP) {
                                        // 四星大保底状态，必出UP角色之一
                                        winnerName = fourStarUPs[Math.floor(Math.random() * fourStarUPs.length)];
                                        isUP = true;
                                        isGuaranteed4StarUP = false; // 使用后重置
                                    } else {
                                        // 四星小保底，50%概率UP
                                        if (Math.random() < 0.5) {
                                            winnerName = fourStarUPs[Math.floor(Math.random() * fourStarUPs.length)];
                                            isUP = true;
                                        } else {
                                            const candidates = students.filter(s => !fourStarUPs.includes(s) && s !== fiveStarUP);
                                            winnerName = candidates[Math.floor(Math.random() * candidates.length)];
                                            isUP = false;
                                            isGuaranteed4StarUP = true; // 触发四星大保底
                                        }
                                    }

                                    // 保存四星大保底状态
                                    localStorage.setItem('isGuaranteed4StarUP', isGuaranteed4StarUP);
                                } else { // 三星
                                    const candidates = students.filter(s => !fourStarUPs.includes(s) && s !== fiveStarUP);
                                    winnerName = candidates[Math.floor(Math.random() * candidates.length)];
                                }
                                updatePityDisplay();
                                // 在抽奖结束后也调用此函数更新显示
                                // 在抽奖逻辑的最后添加:
                                // updatePityDisplay();
                                // 保存抽奖次数和保底计数
                                setPity('totalDraws', totalDraws);
                                setPity('fiveStarPity', fiveStarPity);
                                setPity('fourStarPity', fourStarPity);

                                // 保存大保底状态
                                localStorage.setItem('isGuaranteed5StarUP', isGuaranteed5StarUP);
                                localStorage.setItem('isGuaranteed4StarUP', isGuaranteed4StarUP);


                                // 在滚动区找到中奖人的位置
                                let winnerPos = -1;
                                for (let i = 0; i < scrollingNames.childNodes.length; i++) {
                                    if (scrollingNames.childNodes[i].innerHTML === winnerName) {
                                        winnerPos = i;
                                        break;
                                    }
                                }
                                if (winnerPos === -1) winnerPos = 0;

                                // 高亮中奖人
                                scrollingNames.childNodes.forEach((el, i) => {
                                    if (i === winnerPos) {
                                        el.style.background = rarityConfig[rarityIndex].color;
                                        el.style.color = rarityConfig[rarityIndex].textColor;
                                        el.style.fontWeight = 'bold';
                                        el.style.boxShadow = rarityIndex === 0 ? '0 0 32px 12px #FFD700' :
                                            rarityIndex === 1 ? '0 0 24px 8px #A259FF' :
                                                '0 0 16px 6px #00bfff';
                                        el.style.border = rarityIndex === 0 ? '3px solid #FFD700' :
                                            rarityIndex === 1 ? '3px solid #A259FF' :
                                                '3px solid #00bfff';
                                    } else {
                                        el.style.background = '';
                                        el.style.color = '';
                                        el.style.fontWeight = '';
                                        el.style.boxShadow = '';
                                        el.style.border = '';
                                    }
                                });
                                // 在页面加载完成后预加载音频
                                document.addEventListener('DOMContentLoaded', function () {
                                    const audio = document.getElementById('fiveStarSound');
                                    audio.muted = true; // 先静音
                                    audio.play().then(() => {
                                        audio.pause();
                                        audio.currentTime = 0;
                                        audio.muted = false; // 解除静音
                                    }).catch(error => {
                                        console.log('音频预加载失败:', error);
                                    });
                                });

                                // 显示五星大特效
                                function showFiveStarEffect(name) {
                                    const effectContainer = document.getElementById('wishEffect');
                                    const goldenLight = effectContainer.querySelector('.golden-light');
                                    const characterName = effectContainer.querySelector('.character-name');
                                    const nameText = effectContainer.querySelector('.name-text');

                                    // 播放五星音效
                                    const audio = document.getElementById('fiveStarSound');
                                    audio.currentTime = 0; // 重置音频到开头
                                    audio.play().catch(error => {
                                        console.log('音频自动播放被阻止，需要用户交互:', error);
                                    });

                                    // 设置角色名称
                                    nameText.innerHTML = name;

                                    // 显示特效容器
                                    effectContainer.classList.add('active');

                                    // 动画序列
                                    setTimeout(() => {

                                        // 金光迸发

                                        goldenLight.style.animation = 'goldenLightAnimation 2s ease-out forwards';
                                        goldenLight.style.opacity = '1';

                                        // 显示角色名称                                              
                                        characterName.classList.add('revealed');

                                    });
                                }

                                // 关闭五星特效
                                document.querySelector('.wish-continue-btn').addEventListener('click', function () {
                                    const effectContainer = document.getElementById('wishEffect');
                                    const goldenLight = effectContainer.querySelector('.golden-light');
                                    const characterName = effectContainer.querySelector('.character-name');

                                    // 重置所有动画
                                    goldenLight.style.animation = 'none';
                                    goldenLight.style.opacity = '0';
                                    characterName.classList.remove('revealed');

                                    // 隐藏容器
                                    effectContainer.classList.remove('active');

                                    // 继续正常流程
                                    isRolling = false;
                                    lotteryBtn.disabled = false;
                                });

                                // 在抽到五星时调用此函数
                                // 替换您现有的五星处理代码，改为调用：
                                // showFiveStarEffect(winnerName);
                                let tipColor = rarityIndex === 0 ? '#FFD700' : rarityIndex === 1 ? '#A259FF' : '#00bfff';

                                // 只改这一行：把图标放大并去掉发光
                                const bigIconName = winnerName
                                    .replace(
                                        /(<i[^>]*style="[^"]*font-size:)[^;]+/,
                                        '$12.5rem;text-shadow:none;font-weight:normal'
                                    );   // 放大、去发光、去加粗

                                winnerDiv.innerHTML = `
                                    <span style="background:${rarityConfig[rarityIndex].color};-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold;font-size:2.2rem;">
                                        ${rarityConfig[rarityIndex].name}${isUP ? ' UP' : ''}
                                    </span>
                                    <span style="font-size:3rem;font-weight:bold;color:${tipColor};text-shadow:0 0 10px ${tipColor};">
                                        ${bigIconName}
                                    </span>
                                    <br>
                                    <span style="font-size:1.5rem;color:${tipColor};font-weight:bold;">🎉恭喜被抽中🎉</span>
                                    `;

                                // 添加历史记录
                                addHistoryRecord(winnerName, rarityIndex, isUP);

                                winnerDiv.style.display = 'block';
                                isRolling = false;
                                lotteryBtn.disabled = false;
                            }
                        }
                        requestAnimationFrame(roll);
                    });


                </script>
</body>

</html>